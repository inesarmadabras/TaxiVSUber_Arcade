var Engine=function(e){function a(){var e=Date.now(),t=(e-f)/1e3;n(t),r(),f=e,y.requestAnimationFrame(a)}function t(){p(),f=Date.now(),a()}function n(e){"play"==d?(o(e),l()):selector.update()}function l(){allEnemies.forEach(function(e){e.y===player.y&&player.x>=e.x-50&&player.x<=e.x+80&&(localStorage.highscore=Math.max(player.score,localStorage.highscore),d="gameover")}),bonus&&bonus.y===player.y&&bonus.x===player.x&&(player.score+=bonus.multiplier,bonus=null)}function o(e){allEnemies.forEach(function(a){a.update(e)}),player.update()}function r(){var e,a,t=["images/stone-block.png","images/road-block.png","images/road-block.png","images/road-block.png","images/stone-block.png","images/grass-block.png"],n=6,l=5;for(e=0;e<n;e++)for(a=0;a<l;a++)x.drawImage(Resources.get(t[e]),101*a,83*e);x.fillStyle="white",x.font="20px Inconsolata",x.textAlign="left",x.textBaseline="bottom",x.fillText("Score: "+player.score,10,580),x.fillText("High Score: "+localStorage.highscore,340,580),"start"==d?c():"gameover"==d?g():s()}function s(){bonus&&bonus.render(),allEnemies.forEach(function(e){e.render()}),player.render()}function c(){var e=[[101,"images/uber.png"],[202,"images/cabify.png"],[303,"images/secestado.png"]];for(selector.render(),i=0;i<e.length;i++)x.drawImage(Resources.get(e[i][1]),e[i][0],303),e[i][0]===selector.x&&(h=e[i][1]);x.fillStyle="white",x.font="50px Inconsolata",x.textAlign="center",x.textBaseline="top",x.fillText("Taxi VS Uber",250,60),x.font="20px Inconsolata",x.fillStyle="yellow",x.fillText("Pick up passengers without",250,135),x.fillText("being attacked by a taxi driver...",250,165),x.fillText("or steal passengers of taxis",250,215),x.font="15px Inconsolata",x.fillText("(it's all a matter of perspective)",250,245),x.fillStyle="black",x.font="20px Inconsolata",x.fillText("Uber",150,470),x.fillText("Cabify",250,470),x.fillText("Government",355,470),x.font="30px Inconsolata",x.fillStyle="white",x.fillText("Select your player",250,500)}function g(){x.fillStyle="red",x.textAlign="center",x.textBaseline="top",x.font="80px Inconsolata",x.fillText("Game Over",250,200),x.fillStyle="white",x.font="22px Inconsolata",x.fillText('"Enter" to play again',250,490),x.fillText('"Space" to select a new character',250,520)}function p(){for(allEnemies=[],i=0;i<3;i++)allEnemies[i]=new Enemy;bonus=new Bonus,player=new Player(h)}var f,m=e.document,y=e.window,u=m.createElement("canvas"),x=u.getContext("2d"),d="start",h="";u.width=505,u.height=606,m.body.appendChild(u),localStorage.highscore||(localStorage.highscore=0),document.addEventListener("keyup",function(e){"start"==d&&(e.keyCode<37||e.keyCode>40)?(p(),d="play"):"gameover"==d&&(13==e.keyCode&&(p(),d="play"),32==e.keyCode&&(d="start"))}),Resources.load(["images/stone-block.png","images/road-block.png","images/grass-block.png","images/taxi.png","images/uber.png","images/cabify.png","images/secestado.png","images/char-boy.png","images/char-cat-girl.png","images/char-horn-girl.png","images/char-pink-girl.png","images/char-princess-girl.png","images/Selector.png"]),Resources.onReady(t),e.ctx=x}(this);